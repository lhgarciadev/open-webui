# Fase 3.1 - Ejecutar Descarga de Modelos

## Objetivo
Verificar y descargar los modelos opensource recomendados en el Space.

## Contexto
- El script start.sh ya descarga modelos automáticamente
- Esta fase verifica que los modelos están disponibles
- Opcionalmente agrega modelos adicionales

## Prompt de Ejecución

```
Verifica y gestiona los modelos en el Space de Ollama:

1. VERIFICAR MODELOS DISPONIBLES:

   # Listar modelos en el Space (reemplaza TU_USUARIO)
   curl -s https://TU_USUARIO-cognitia-ollama.hf.space/api/tags | jq

   # Respuesta esperada:
   {
     "models": [
       {"name": "qwen2.5:7b", ...},
       {"name": "phi3", ...},
       {"name": "codellama:7b", ...}
     ]
   }

2. VERIFICAR ESTADO DE DESCARGA:

   # Ver logs del Space para estado de descarga
   # https://huggingface.co/spaces/TU_USUARIO/cognitia-ollama

   # Click en "Logs"
   # Buscar:
   # - "Descargando qwen2.5:7b"
   # - "qwen2.5:7b ya disponible"
   # - Porcentaje de descarga si está en progreso

3. TEST DE CADA MODELO:

   # Test phi3 (más rápido)
   echo "=== Testing phi3 ==="
   time curl -s https://TU_USUARIO-cognitia-ollama.hf.space/api/generate \
     -H "Content-Type: application/json" \
     -d '{"model": "phi3", "prompt": "Hola, responde en una línea", "stream": false}' \
     | jq -r '.response'

   # Test qwen2.5:7b (mejor calidad)
   echo "=== Testing qwen2.5:7b ==="
   time curl -s https://TU_USUARIO-cognitia-ollama.hf.space/api/generate \
     -H "Content-Type: application/json" \
     -d '{"model": "qwen2.5:7b", "prompt": "Escribe una función Python para sumar dos números", "stream": false}' \
     | jq -r '.response'

   # Test codellama:7b (código)
   echo "=== Testing codellama:7b ==="
   time curl -s https://TU_USUARIO-cognitia-ollama.hf.space/api/generate \
     -H "Content-Type: application/json" \
     -d '{"model": "codellama:7b", "prompt": "Write a JavaScript function to reverse a string", "stream": false}' \
     | jq -r '.response'

4. VERIFICAR TAMAÑOS:

   # Los modelos deberían ocupar aproximadamente:
   # - phi3: ~2.3GB
   # - qwen2.5:7b: ~4.7GB
   # - codellama:7b: ~3.8GB
   # Total: ~10.8GB

5. SI FALTAN MODELOS (alternativa manual):

   # Si algún modelo no está, agregar al start.sh
   cd ~/cognitia-ollama-space

   # Editar start.sh y agregar el modelo faltante
   # Ejemplo: agregar mistral
   # ollama pull mistral:7b

   # Commit y push
   git add start.sh
   git commit -m "feat: Add missing model"
   git push

   # El Space se reconstruirá y descargará el modelo

6. DOCUMENTAR MODELOS DISPONIBLES:

   curl -s https://TU_USUARIO-cognitia-ollama.hf.space/api/tags | jq '.models[] | {name: .name, size: .size}' > modelos_disponibles.json
   cat modelos_disponibles.json

Entrega:
- Lista de modelos disponibles
- Output de test de cada modelo
- Tiempos de respuesta
```

## Modelos Objetivo

| Modelo | Tamaño | Propósito | Estado Esperado |
|--------|--------|-----------|-----------------|
| qwen2.5:7b | 4.7GB | Chat + Coding | ✅ Incluido |
| phi3 | 2.3GB | Respuestas rápidas | ✅ Incluido |
| codellama:7b | 3.8GB | Programación | ✅ Incluido |

## Checklist de Ejecución

```
VERIFICACIÓN
[ ] /api/tags muestra modelos
[ ] qwen2.5:7b disponible
[ ] phi3 disponible
[ ] codellama:7b disponible

TESTS
[ ] phi3 responde correctamente
[ ] qwen2.5:7b responde correctamente
[ ] codellama:7b responde correctamente
[ ] Tiempos < 2 segundos

DOCUMENTACIÓN
[ ] Lista de modelos guardada
[ ] Tiempos de respuesta anotados
```

## Troubleshooting

### Modelo no aparece en lista
```bash
# El modelo puede estar descargándose
# Ver logs del Space y buscar progreso

# Si después de 10 min no aparece:
# Reiniciar Space: Settings → Factory reboot
```

### Error "model not found"
```bash
# Verificar nombre exacto
curl -s https://TU_USUARIO-cognitia-ollama.hf.space/api/tags | jq '.models[].name'

# Usar el nombre exacto (incluyendo :tag)
# Ejemplo: "qwen2.5:7b" no "qwen2.5"
```

### Descarga lenta
```bash
# Normal en primer inicio
# Cada modelo toma 5-15 minutos
# Total para 3 modelos: 15-45 minutos

# El Space mantiene modelos entre reinicios
# Solo descarga una vez
```

## Tiempo Estimado

| Paso | Tiempo |
|------|--------|
| Verificar modelos | 1-2 min |
| Tests | 2-3 min |
| Documentar | 1 min |
| **Total** | **4-6 min** |

*Nota: Si los modelos están descargándose, puede tomar 15-45 min adicionales.*

## Siguiente Paso

Continuar a [3.2-models-validar.md](./3.2-models-validar.md) para validar los modelos.
