# Etapa 1.2 - Validar Integración de Imágenes

## Objetivo

Verificar que el servicio de imágenes funciona correctamente con fallbacks.

## Prompt de Validación

```
Valida la integración de imágenes:

1. UNIT TESTS:
   - test_extract_keywords(): verifica extracción correcta
   - test_search_unsplash(): verifica búsqueda (si hay API key)
   - test_search_pexels(): verifica búsqueda (si hay API key)
   - test_fallback(): verifica que Pexels se usa cuando Unsplash falla
   - test_cache(): verifica que imágenes se cachean

2. INTEGRATION TEST:
   - Generar presentación con título "Inteligencia Artificial"
   - Verificar que al menos 1 slide tiene imagen
   - Verificar que atribución está presente

3. FALLBACK TEST:
   - Configurar solo PEXELS_API_KEY (sin Unsplash)
   - Generar presentación
   - Verificar que imágenes vienen de Pexels

4. GRACEFUL DEGRADATION:
   - Sin ninguna API key configurada
   - Generar presentación
   - Verificar que NO hay errores
   - Verificar que presentación se genera (sin imágenes)

Entrega:
- PASS/FAIL por cada caso
- Capturas o logs de evidencia
- Tamaño de archivo PPTX generado
```

## Criterios de Éxito

| Test        | Criterio                                      | PASS/FAIL |
| ----------- | --------------------------------------------- | --------- |
| Keywords    | Extrae 2-3 palabras relevantes                | **PASS**  |
| Wikimedia   | Retorna imagen para "artificial intelligence" | **PASS**  |
| Cache       | Segunda descarga es instantánea               | **PASS**  |
| Degradation | Sin API keys no hay crash                     | **PASS**  |
| Atribución  | Nombre del fotógrafo visible                  | **PASS**  |
| Integration | Presentación con imagen generada              | **PASS**  |

> **Nota**: La implementación usa **Wikimedia Commons** (gratuito, sin API key) en lugar de Unsplash/Pexels.

## Resultados de Validación (2026-02-14)

### Unit Tests: 4/4 PASSED

```
test_extract_keywords ................ PASSED
test_search_image_wikimedia .......... PASSED
test_download_image_caching .......... PASSED
test_image_service_integration ....... PASSED
```

### Integration Test

- **Presentación generada**: "Inteligencia Artificial"
- **Archivo**: `Inteligencia_Artificial_20260214_004821.pptx`
- **Tamaño**: 123,407 bytes (123 KB)
- **Imágenes encontradas**: 1 (en Slide 3 - Aplicaciones)
- **Atribución**: "Photo: Gobierno Aguascalientes (Wikimedia Commons)"

### Graceful Degradation Test

- Queries sin resultados: **No crash, retorna None**
- String vacío: **No crash, retorna None**
- None como input: **No crash, retorna ""**

## Comandos de Prueba

```bash
# Unit tests
cd backend && pytest tests/test_image_service.py -v

# Test manual
python -c "
import asyncio
from open_webui.utils.image_service import search_image

async def test():
    result = await search_image('artificial intelligence')
    print(f'Source: {result.get(\"source\") if result else \"No result\"}')
    print(f'URL: {result.get(\"url\")[:50] if result else \"N/A\"}...')

asyncio.run(test())
"
```

## Siguiente Paso

Si todos los tests pasan → Avanzar a [Etapa 2.1 - Diseño](./2.1-diseno-ejecutar.md)
