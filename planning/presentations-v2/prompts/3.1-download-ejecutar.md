# Etapa 3.1 - Ejecutar Fix de Descarga

## Objetivo

Asegurar que los enlaces de descarga funcionan correctamente (sin prefijo `sandbox:`).

## Estado

**YA IMPLEMENTADO** - Esta etapa solo requiere verificación.

## Contexto

- Documento de referencia: [`../3-download-fix.md`](../3-download-fix.md)
- Problema original: GPT-4o agregaba `sandbox:` a URLs relativas
- Solución: Usar URLs absolutas con `WEBUI_URL`

## Prompt de Ejecución (Verificación)

````
Verifica la implementación del fix de descarga:

1. CÓDIGO ACTUAL:
   - Revisar presentations.py
   - Confirmar que download_url usa URL absoluta
   - Confirmar que se usa __request__.base_url o WEBUI_URL

2. CONFIGURACIÓN:
   - Verificar que WEBUI_URL está en Railway variables
   - Valor esperado: https://cognitia-production.up.railway.app

3. SI NO ESTÁ IMPLEMENTADO:
   - Implementar según 3-download-fix.md
   - Cambiar retorno de URL relativa a absoluta:
     ```python
     base_url = ""
     if __request__:
         try:
             base_url = str(__request__.base_url).rstrip('/')
         except:
             pass
         if not base_url or base_url == "http://testserver":
             base_url = WEBUI_URL.rstrip('/') if WEBUI_URL else ""

     download_url = f"{base_url}/api/v1/files/presentations/{filename}"
     ```

Entrega:
- Confirmación de que el código está correcto
- Variable WEBUI_URL configurada
````

## Verificación Rápida

```bash
# Verificar variable en Railway
railway variables | grep WEBUI_URL

# Buscar en código
grep -n "download_url" backend/open_webui/tools/presentations.py
```

## Cambio Clave (Ya Implementado)

```python
# ANTES (problemático)
"download_url": f"/api/v1/files/presentations/{filename}"

# DESPUÉS (correcto)
"download_url": f"{base_url}/api/v1/files/presentations/{filename}"
```
