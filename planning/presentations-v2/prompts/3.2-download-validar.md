# Etapa 3.2 - Validar Fix de Descarga

## Objetivo
Verificar que las descargas funcionan al 100% en producción.

## Prompt de Validación

```
Valida el fix de descarga:

1. TEST EN PRODUCCIÓN:
   - Ir a https://cognitia-production.up.railway.app
   - Iniciar chat con modelo GPT-4o
   - Pedir: "Genera una presentación de 3 slides sobre inteligencia artificial"
   - Verificar que el enlace de descarga:
     a. NO tiene prefijo "sandbox:"
     b. Empieza con "https://cognitia-production.up.railway.app"
     c. Al hacer clic, descarga el archivo PPTX

2. VERIFICAR URL EN RESPONSE:
   - Revisar la respuesta JSON del modelo
   - download_url debe ser URL absoluta completa
   - Ejemplo correcto:
     https://cognitia-production.up.railway.app/api/v1/files/presentations/IA_20260214.pptx

3. VERIFICAR ARCHIVO:
   - Archivo descargado tiene extensión .pptx
   - Se puede abrir en PowerPoint/LibreOffice
   - Contenido coincide con lo solicitado

4. EDGE CASES:
   - Título con caracteres especiales (ñ, á, é)
   - Título muy largo (>50 caracteres)
   - Múltiples presentaciones seguidas

Entrega:
- PASS/FAIL por cada test
- Screenshot del enlace de descarga
- Archivo PPTX descargado como evidencia
```

## Criterios de Éxito

| Test | Criterio | PASS/FAIL |
|------|----------|-----------|
| Sin sandbox: | URL no tiene "sandbox:" | |
| URL absoluta | Empieza con https://... | |
| Click funciona | Archivo se descarga | |
| Archivo válido | Se abre en PowerPoint | |
| Chars especiales | Funciona con ñ, á, é | |
| Títulos largos | Funciona con >50 chars | |

## Troubleshooting

### Si URL sigue siendo relativa:
1. Verificar `WEBUI_URL` en Railway
2. Reiniciar servicio: `railway up`
3. Revisar logs: `railway logs`

### Si da 404:
1. Verificar que directorio `/tmp/presentations/` existe
2. Verificar permisos de escritura
3. Revisar endpoint en `routers/files.py`

### Si da about:blank:
1. El modelo sigue agregando `sandbox:`
2. Verificar que el código usa URL absoluta
3. Verificar que `WEBUI_URL` no está vacío

## Siguiente Paso

Si todos los tests pasan → Avanzar a [Etapa 4.1 - QA Final](./4.1-qa-final-ejecutar.md)
