# Etapa 4.4 - Corregir Responsividad del Chat

## Objetivo
Asegurar que el sidebar/modulo izquierdo no se sobreponga al contenido del chat en ninguna resolucion, garantizando legibilidad completa en mobile, tablet y desktop.

## Problema Actual

- Al abrir el sidebar izquierdo, se sobrepone al contenido del chat
- En pantallas pequenas el contenido queda tapado
- No hay overlay/backdrop para indicar que el sidebar esta abierto
- Breakpoints no estan bien definidos

## Prompt de Ejecucion

```
Corrige la responsividad del chat para evitar superposicion del sidebar:

1. INVESTIGAR ESTRUCTURA ACTUAL:

   Leer y analizar:
   - src/lib/components/layout/Sidebar.svelte
   - src/routes/(app)/+layout.svelte
   - src/app.css (buscar z-index y breakpoints)
   - Cualquier otro componente de layout relevante

2. IDENTIFICAR PROBLEMA:

   Documentar:
   - Como funciona actualmente el toggle del sidebar
   - Que CSS controla el posicionamiento
   - Que breakpoints estan definidos
   - Valores de z-index actuales

3. IMPLEMENTAR SOLUCION - OPCION A (Drawer Pattern):

   Para mobile/tablet (< 1024px):

   a) Sidebar como drawer overlay:
      - position: fixed
      - z-index mayor que contenido
      - transform: translateX(-100%) cuando cerrado
      - transform: translateX(0) cuando abierto

   b) Backdrop oscuro:
      - Div con background semi-transparente
      - Click en backdrop cierra sidebar
      - z-index entre sidebar y contenido

   c) Contenido principal:
      - NO se mueve cuando sidebar abre
      - Queda "detras" del overlay

   Para desktop (>= 1024px):
   - Sidebar fijo a la izquierda
   - Contenido se ajusta con margin-left
   - Sin overlay

4. IMPLEMENTAR SOLUCION - OPCION B (Push Pattern):

   Sidebar empuja el contenido:
   - Sidebar tiene width fija
   - Contenido tiene margin-left dinamico
   - Transicion suave

   NOTA: Esta opcion puede causar reflow, preferir Opcion A

5. DEFINIR BREAKPOINTS CONSISTENTES:

   // En tailwind.config.js o CSS
   --breakpoint-sm: 640px;   // Mobile landscape
   --breakpoint-md: 768px;   // Tablet portrait
   --breakpoint-lg: 1024px;  // Tablet landscape / Small desktop
   --breakpoint-xl: 1280px;  // Desktop
   --breakpoint-2xl: 1536px; // Large desktop

6. ASEGURAR Z-INDEX CORRECTO:

   Orden de capas (de atras hacia adelante):
   1. Contenido principal: z-index: 1
   2. Sidebar (desktop): z-index: 10
   3. Backdrop (mobile): z-index: 40
   4. Sidebar drawer (mobile): z-index: 50
   5. Modales: z-index: 100
   6. Toasts/Notifications: z-index: 200

7. AGREGAR BACKDROP COMPONENT:

   Si no existe, crear:

   <script>
     export let show = false;
     export let onClick = () => {};
   </script>

   {#if show}
     <div
       class="fixed inset-0 bg-black/50 z-40 lg:hidden"
       on:click={onClick}
       transition:fade={{ duration: 200 }}
     />
   {/if}

8. TESTEAR EN MULTIPLES RESOLUCIONES:

   - 375px (iPhone SE)
   - 414px (iPhone Plus)
   - 768px (iPad portrait)
   - 1024px (iPad landscape)
   - 1280px (Desktop)
   - 1920px (Full HD)

9. VERIFICAR EDGE CASES:

   - Sidebar abierto + modal abierto
   - Sidebar abierto + dropdown abierto
   - Rotar dispositivo con sidebar abierto
   - Click fuera del sidebar lo cierra

Entrega:
- Archivos modificados
- Screenshot/video de cada resolucion
- Lista de breakpoints documentados
```

## Analisis Previo Requerido

### Archivos a Revisar

```
src/
├── lib/
│   └── components/
│       └── layout/
│           ├── Sidebar.svelte       # Componente principal
│           ├── Navbar.svelte        # Barra superior
│           └── ...
├── routes/
│   └── (app)/
│       └── +layout.svelte           # Layout principal
└── app.css                          # Estilos globales
```

### Preguntas a Responder

1. El sidebar usa `position: fixed` o `position: absolute`?
2. Hay un store de Svelte que controla `sidebarOpen`?
3. El contenido principal tiene `margin-left` o `padding-left` dinamico?
4. Existen clases de Tailwind para responsive ya implementadas?

## Especificacion CSS

### Patron Drawer (Recomendado)

```css
/* Sidebar base */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 280px;
  z-index: 50;
  transform: translateX(-100%);
  transition: transform 0.3s ease-in-out;
}

.sidebar.open {
  transform: translateX(0);
}

/* Desktop: siempre visible */
@media (min-width: 1024px) {
  .sidebar {
    transform: translateX(0);
    z-index: 10;
  }

  .main-content {
    margin-left: 280px;
  }
}

/* Backdrop */
.sidebar-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 40;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
}

.sidebar-backdrop.visible {
  opacity: 1;
  visibility: visible;
}
```

### Tailwind Classes

```html
<!-- Sidebar -->
<aside class="
  fixed inset-y-0 left-0 z-50 w-72
  transform -translate-x-full transition-transform duration-300
  lg:translate-x-0 lg:z-10
  {sidebarOpen ? 'translate-x-0' : '-translate-x-full'}
">

<!-- Backdrop (mobile only) -->
{#if sidebarOpen}
  <div
    class="fixed inset-0 bg-black/50 z-40 lg:hidden"
    on:click={closeSidebar}
  />
{/if}

<!-- Main content -->
<main class="lg:ml-72 min-h-screen">
```

## Checklist de Validacion

```
ESTRUCTURA
[ ] Sidebar usa position: fixed
[ ] Contenido principal no se mueve en mobile
[ ] Backdrop existe para mobile

RESPONSIVIDAD
[ ] 375px: sidebar como drawer, backdrop funciona
[ ] 768px: sidebar como drawer, backdrop funciona
[ ] 1024px+: sidebar fijo, sin backdrop, contenido con margin

INTERACCION
[ ] Click en hamburger abre sidebar
[ ] Click en backdrop cierra sidebar
[ ] Click en link dentro de sidebar cierra sidebar (mobile)
[ ] Escape key cierra sidebar

Z-INDEX
[ ] Sidebar no tapa modales
[ ] Backdrop esta detras del sidebar
[ ] Contenido esta detras del backdrop

TRANSICIONES
[ ] Sidebar tiene animacion suave (300ms)
[ ] Backdrop tiene fade suave
[ ] No hay saltos o glitches

ACCESIBILIDAD
[ ] Focus trap en sidebar cuando esta abierto (mobile)
[ ] aria-hidden en contenido cuando sidebar abierto
[ ] Boton de cerrar tiene aria-label
```

## Test Visual

Probar en:

| Dispositivo | Resolucion | Sidebar | Contenido |
|-------------|------------|---------|-----------|
| iPhone SE | 375x667 | Drawer + backdrop | Legible |
| iPhone 14 | 390x844 | Drawer + backdrop | Legible |
| iPad | 768x1024 | Drawer + backdrop | Legible |
| iPad Pro | 1024x1366 | Fijo, sin backdrop | Margin-left |
| Desktop | 1920x1080 | Fijo, sin backdrop | Margin-left |

## Siguiente Paso

Una vez completados 4.3 y 4.4, proceder con sync de upstream (documento 6-upstream-sync.md).
