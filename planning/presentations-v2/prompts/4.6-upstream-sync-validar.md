# Etapa 4.6 - Validar Sync con Upstream

## Objetivo
Verificar que el merge con upstream fue exitoso y no hay regresiones.

## Prompt de Validacion

```
Valida el sync con upstream de Open WebUI:

1. VERIFICAR HISTORIAL GIT:

   # Ver ultimos commits
   git log --oneline -10

   # Debe mostrar merge commit reciente
   # Ejemplo: "Merge branch 'upstream/main' into main"

   # Ver grafico de branches
   git log --graph --oneline -20

2. VERIFICAR BRANDING:

   # Identity file
   cat src/lib/constants/identity.ts
   # Debe contener "Cognitia" no "Open WebUI"

   # Buscar referencias incorrectas
   grep -r "Open WebUI" src/ --include="*.svelte" --include="*.ts" | grep -v node_modules | wc -l
   # Debe ser 0 (o solo en comentarios/licencias)

   # Verificar favicons
   file static/favicon.ico
   file static/logo.png
   # Deben existir y ser nuestros assets

3. VERIFICAR BUILD:

   # Clean build
   rm -rf node_modules/.vite
   rm -rf .svelte-kit

   # Reinstalar
   npm ci

   # Check tipos
   npm run check
   # Debe pasar sin errores

   # Build produccion
   npm run build
   # Debe completar exitosamente

4. VERIFICAR BACKEND:

   cd backend

   # Reinstalar deps
   pip install -r requirements.txt --upgrade

   # Test import
   python -c "
   from open_webui.main import app
   from open_webui.config import WEBUI_NAME
   print(f'App OK, name: {WEBUI_NAME}')
   "
   # Debe mostrar "Cognitia" no "Open WebUI"

   cd ..

5. TEST FUNCIONAL - LOGIN:

   # Iniciar app
   cd backend && ./dev.sh &
   npm run dev &

   # En navegador:
   # 1. Abrir http://localhost:5173
   # 2. Verificar pagina de login
   # 3. Login con credenciales
   # 4. Verificar dashboard

   [ ] Pagina carga correctamente
   [ ] Logo Cognitia visible
   [ ] Titulo "Cognitia" en tab
   [ ] Login funciona

6. TEST FUNCIONAL - CHAT:

   [ ] Crear nuevo chat
   [ ] Enviar mensaje
   [ ] Recibir respuesta
   [ ] Historial guarda correctamente

7. TEST FUNCIONAL - FEATURES CUSTOM:

   a) Presentations:
      [ ] Toggle de presentaciones visible
      [ ] Activar toggle
      [ ] Pedir presentacion al modelo
      [ ] Verificar que se genera
      [ ] Link de descarga funciona

   b) Otras features custom (si hay):
      [ ] [Feature 1] funciona
      [ ] [Feature 2] funciona

8. VERIFICAR NUEVAS FEATURES DE UPSTREAM:

   # Revisar changelog de Open WebUI
   # Verificar si hay nuevas features que deberiamos probar

   [ ] [Nueva feature 1] disponible
   [ ] [Nueva feature 2] disponible

9. VERIFICAR COMPLIANCE FINAL:

   # Script de verificacion
   ./scripts/verify_compliance.sh
   # Debe pasar completamente

   # Verificacion manual
   grep -rn "Open WebUI" src/ --include="*.svelte" | grep -v "// " | grep -v "license"
   # Debe estar vacio o solo tener referencias permitidas

10. DOCUMENTAR CAMBIOS:

    # Listar nuevas dependencias
    git diff HEAD~1 package.json | grep "+"

    # Listar archivos modificados
    git diff --name-only HEAD~1 | head -30

    # Documentar en planning/ si hay cambios importantes

Entrega:
- Resultado de npm run check
- Resultado de npm run build
- Screenshot de app con branding correcto
- Lista de nuevas features de upstream
- Confirmacion de features custom funcionando
```

## Matriz de Validacion

### Branding

| Elemento | Esperado | Actual | PASS/FAIL |
|----------|----------|--------|-----------|
| identity.ts | "Cognitia" | | |
| Favicon | Cognitia icon | | |
| Logo navbar | Cognitia logo | | |
| Titulo tab | "Cognitia" | | |
| Login page | Sin "Open WebUI" | | |

### Build

| Test | Comando | Resultado | PASS/FAIL |
|------|---------|-----------|-----------|
| Types | npm run check | | |
| Build | npm run build | | |
| Backend | python import | | |
| Lint | npm run lint | | |

### Funcionalidad

| Feature | Test | PASS/FAIL |
|---------|------|-----------|
| Login | Credenciales validas | |
| Chat | Enviar/recibir mensaje | |
| Modelos | Selector funciona | |
| Settings | Guardar configuracion | |
| Presentations | Generar y descargar | |

### Compliance

| Check | Criterio | PASS/FAIL |
|-------|----------|-----------|
| No "Open WebUI" en UI | grep limpio | |
| Assets propios | favicon/logo | |
| Script verificacion | ./verify_compliance.sh | |

## Resultado Final

### Si todo pasa:
```
BRANDING:       ✅ PASS - Cognitia visible
BUILD:          ✅ PASS - Sin errores
FUNCIONALIDAD:  ✅ PASS - Todo funciona
COMPLIANCE:     ✅ PASS - Sin violaciones

SYNC UPSTREAM:  ✅ COMPLETADO EXITOSAMENTE

Nuevas features disponibles:
- [Feature 1 de upstream]
- [Feature 2 de upstream]
```

### Si hay issues:
```
[AREA]:         ❌ FAIL - [descripcion]
ACCION:         [pasos para corregir]

ROLLBACK SI NECESARIO:
git revert HEAD  # Revertir merge
# o
git reset --hard HEAD~1  # Si no se pusheo
```

## Rollback de Emergencia

```bash
# Si algo salio muy mal y ya se pusheo
git revert <merge-commit-hash>
git push origin main

# Si no se ha pusheado
git reset --hard HEAD~1

# Volver a branch de sync para corregir
git checkout sync/upstream-YYYYMMDD
# Hacer correcciones
# Repetir merge
```

## Siguiente Paso

Si pasa -> Sync completado. Continuar con desarrollo normal.

Si falla -> Corregir issues y repetir validacion.
