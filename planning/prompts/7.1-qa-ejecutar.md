# Etapa 7.1 - Ejecutar QA Final

## Prompt

Corre QA final integral para cerrar incidente:

1. Regresión de tools nativas.
2. Regresión de tema/UI.
3. Revisión de documentación en `planning/`.

Entrega:

- Lista de hallazgos priorizados.
- Acciones de corrección final.

Riesgos pendientes a verificar en QA:

- Warnings de Svelte durante build: self-closing tags en elementos no-void, a11y, CSS no usado, exports sin uso. No bloquean build pero ensucian logs y pueden ocultar issues reales.
  - Contexto: aparecen tanto en build standard como white-label (vite-plugin-svelte).
  - Evidencia: en build se ven warnings tipo `element_invalid_self_closing_tag`, `a11y_consider_explicit_label`, `css_unused_selector`, `export_let_unused`.
  - Checks:
    - `docker build -t cognitia .` y `docker build -f Dockerfile.whitelabel -t cognitia .` sin errores.
    - Capturar lista de warnings y priorizar los que afectan accesibilidad o HTML inválido.
  - Resultado esperado: warnings documentados y plan de corrección (no es obligatorio corregir en QA si scope no lo permite).

- Aviso de `tsconfig.json` sobre `./.svelte-kit/tsconfig.json` faltante al inicio del build.
  - Contexto: aparece durante `npm run build` dentro de Docker.
  - Impacto: no rompe el build, pero podría ocultar problemas de tipos si el build se interrumpe antes de generar `.svelte-kit/`.
  - Checks:
    - Verificar que el build genera `.svelte-kit/` y termina OK.
    - Si el warning persiste, evaluar si el flujo correcto es correr `npm run prepare` o `npm run build` en orden (o ajustar `tsconfig`).

- Dockerfile usa `ENV` para `OPENAI_API_KEY` y `WEBUI_SECRET_KEY` (secrets en layers).
  - Contexto: warning de Docker `SecretsUsedInArgOrEnv`.
  - Impacto: exposición potencial de secretos en layers o en historial de imagen.
  - Checks:
    - Confirmar que para producción se usará `docker compose --env-file` o secrets.
    - Documentar opción recomendada: `secrets` de Docker o runtime env sin bakear en la imagen.

- `ollama` puede quedarse en `health: starting` mientras descarga modelos.
  - Contexto: en `docker compose` el servicio Ollama tarda en pasar a healthy si descarga modelos.
  - Impacto: funciones LLM locales pueden no estar listas; el frontend debe seguir respondiendo.
  - Checks:
    - Validar que el frontend responde `200` en `http://localhost:3000/` aun si `ollama` está `starting`.
    - Probar un chat local si el modelo ya está disponible; si no, documentar que depende de descarga.

- Conflicto de puerto entre compose standard y white-label.
  - Contexto: ambos mapean `3000:8080`. No pueden convivir.
  - Checks:
    - Verificar que solo uno esté levantado a la vez, o cambiar `PORT`/mapeo en `docker-compose.whitelabel.yaml`.
    - Documentar el puerto final usado en QA.

- Variable requerida `SECRET_KEY` en `docker-compose.whitelabel.yaml`.
  - Contexto: compose falla si no se define `SECRET_KEY`.
  - Checks:
    - Levantar con `SECRET_KEY=dev-secret docker compose -f docker-compose.whitelabel.yaml up -d`
    - Alternativa: `docker compose --env-file .env.whitelabel -f docker-compose.whitelabel.yaml up -d`

Criterios de cierre (PASS/FAIL QA):

- PASS si:
  - Ambos builds Docker (standard y white-label) completan sin errores.
  - Compose standard y white-label levantan y el frontend responde `200` en `http://localhost:3000/`.
  - Warnings de Svelte y Docker quedan listados y priorizados con acciones propuestas.
  - Compliance de marca sigue limpio (sin “Open WebUI” en UI/build).
  - Se documenta cómo inyectar `SECRET_KEY` en white-label y se evita conflicto de puertos.
- FAIL si:
  - Algún build Docker falla o no termina.
  - El frontend no responde `200`.
  - Se detectan referencias a “Open WebUI”.
  - No se puede levantar white-label por falta de `SECRET_KEY` o conflicto de puertos sin workaround.
